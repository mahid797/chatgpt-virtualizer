@layer base, components, utilities;

/* ===========================
   Base
   =========================== */
@layer base {
	* {
		box-sizing: border-box;
	}

	:root {
		color-scheme: dark;
	}
	@media (prefers-color-scheme: light) {
		:root {
			color-scheme: light;
		}
	}

	html,
	body {
		margin: 0;
		padding: 0;
		width: var(--popup-w);
		background: var(--popup-surface);
		color: var(--popup-text);
		font: 13px/1.45 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
			Arial, 'Apple Color Emoji';
	}

	/* Typography (TYPE) */
	.title h1 {
		margin: 0;
		font-size: var(--fs-md);
		font-weight: 600;
		line-height: var(--lh-tight);
	}
	.title .sub {
		margin: var(--space-1) 0 0;
		font-size: var(--fs-sm);
		color: var(--popup-hint);
		line-height: var(--lh-normal);
	}
}

/* ===========================
   Components
   =========================== */
@layer components {
	/* Header */
	.topbar {
		display: grid;
		grid-template-columns: 24px 1fr auto auto;
		align-items: center;
		gap: var(--space-2);
		padding: var(--space-3) var(--space-3);
		border-bottom: 1px solid var(--popup-border);
	}
	.logo-img {
		width: 24px;
		height: 24px;
		border-radius: 4px;
	}

	/* Toggle switch */
	.switch {
		position: relative;
		width: var(--switch-width);
		height: var(--switch-height);
		display: inline-block;
		cursor: pointer;
	}
	.switch input {
		display: none;
	}
	.slider {
		position: absolute;
		inset: 0;
		background: var(--switch-track-bg);
		border-radius: 999px;
		transition: background-color var(--switch-transition);
		cursor: pointer;
	}
	.slider::after {
		content: '';
		position: absolute;
		top: 3px;
		left: 3px;
		width: var(--switch-thumb-size);
		height: var(--switch-thumb-size);
		border-radius: 50%;
		background: var(--switch-thumb-bg);
		transition: transform var(--switch-thumb-transition);
	}
	.switch input:checked + .slider {
		background: var(--switch-track-checked-bg);
	}
	.switch input:checked + .slider::after {
		transform: translateX(var(--switch-thumb-translate));
	}

	/* Shared focus ring for accessibility */
	.switch:focus-within .slider {
		outline: 2px solid var(--btn-focus-ring);
		outline-offset: 2px;
	}

	/* Tiny "press" affordance */
	.switch:active .slider::after {
		transform: scale(0.96);
	}
	.switch input:checked + .slider:active::after {
		transform: translateX(var(--switch-thumb-translate)) scale(0.96);
	}

	/* Cards */
	main {
		padding: var(--space-3) var(--space-3);
	}
	.card {
		border: 1px solid var(--card-border);
		background: var(--card-bg);
		border-radius: var(--card-radius);
		padding: var(--card-pad);
		margin: var(--card-gap-y) 0;
		box-shadow: var(--elevation-1); /* subtle depth */
	}
	.card h2 {
		margin: 0 0 var(--space-2);
		font-size: var(--fs-lg);
		font-weight: 600;
		color: var(--popup-muted);
		line-height: var(--lh-tight);
		/* removed fuzzy letter-spacing */
	}

	/* Rows & fields */
	.row {
		display: grid;
		grid-template-columns: var(--form-label-w) 1fr;
		align-items: center; /* vertically center label & controls */
		gap: var(--space-1);
	}
	.label {
		color: var(--popup-text);
		font-size: var(--fs-md);
		line-height: var(--lh-normal);
		white-space: nowrap;
		padding-right: var(--space-2);
	}
	.field-inline {
		display: flex;
		align-items: center;
		gap: var(--space-3);
		min-width: 0;
	}

	.field-inline .suffix {
		margin-left: -8px;
	}

	/* Generic field */
	.field {
		width: 100%;
		max-width: var(--field-max-w);
		padding: var(--field-pad-y) var(--field-pad-x);
		border-radius: var(--field-radius);
		border: 1px solid var(--field-border);
		background: var(--field-bg);
		color: var(--field-fg);
	}
	.field:hover {
		background: var(--field-hover-bg);
	}
	.field:focus {
		outline: 2px solid var(--field-focus-ring);
		outline-offset: 1px;
	}
	input[type='number'],
	input[type='text'] {
		font: inherit;
		color: inherit;
	}

	/* Suffix */
	.suffix {
		color: var(--popup-muted);
		font-size: var(--fs-sm);
		align-self: center;
	}

	/* Help */
	.hint {
		color: var(--popup-hint);
		font-size: var(--fs-sm);
		line-height: var(--lh-normal);
	}
	.row .help {
		grid-column: 1 / -1;
		margin: var(--space-2) 0 0;
		color: var(--popup-hint);
		font-size: var(--fs-sm);
		line-height: var(--lh-normal);
	}
	@media (prefers-color-scheme: light) {
		.hint,
		.row .help {
			color: color-mix(in oklab, var(--popup-hint), var(--popup-text) 22%);
		}
	}
	.row.compact {
		margin-top: var(--space-2);
	}
	.btn-nowrap {
		white-space: nowrap;
	}

	/* Buttons */
	.actions {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
		gap: var(--space-2);
	}

	.btn {
		border: 1px solid var(--btn-border);
		background: var(--btn-bg);
		color: var(--btn-fg);
		border-radius: var(--btn-radius);
		padding: var(--btn-pad-y) var(--btn-pad-x);
		cursor: pointer;
		transition: background-color var(--dur-1) var(--ease-1),
			border-color var(--dur-1) var(--ease-1), color var(--dur-1) var(--ease-1);
		display: inline-flex;
		align-items: center;
		gap: var(--space-2);

		&:hover {
			background: var(--btn-hover-bg);
		}

		/* Focus ring for keyboard nav */
		&:focus-visible {
			outline: 2px solid var(--btn-focus-ring);
			outline-offset: 2px;
		}

		/* Internals with low specificity */
		& :where(.btn__label) {
			display: block;
			flex: 1 1 auto;
			min-width: 0;
			text-align: center; /* centers label even when a kbd chip is present */
		}
		& :where(.btn__kbd) {
			display: inline-block;
			padding: 2px 6px;
			border-radius: var(--chip-radius);
			border: 1px solid var(--chip-border);
			background: var(--chip-bg);
			color: var(--chip-fg);
			font-size: var(--chip-font-size);
			margin-left: auto; /* pins chip to the right edge */
		}

		/* Variants */
		&[data-variant='primary'] {
			background: var(--btn-primary-bg);
			border-color: var(--btn-primary-border);
			color: var(--btn-primary-fg);
			&:hover {
				background: var(--btn-primary-hover-bg);
				border-color: var(--btn-primary-hover-bg);
			}
		}
		&[data-variant='secondary'] {
			background: var(--btn-secondary-bg);
			border-color: var(--btn-secondary-border);
			color: var(--btn-secondary-fg);
			&:hover {
				background: var(--btn-secondary-hover-bg);
			}
		}
		&[data-variant='ghost'] {
			background: transparent;
			border-color: transparent;
			color: var(--link-fg);
			&:hover {
				background: var(--link-hover-bg);
				border-color: var(--link-border);
			}
		}

		&:disabled {
			opacity: var(--btn-disabled-opacity);
			cursor: not-allowed;
			/* keep borders/fg from looking muddy */
			color: color-mix(in oklab, var(--btn-fg), var(--popup-text) 40%);
			border-color: color-mix(in oklab, var(--btn-border), transparent 20%);
		}
	}

	/* KBD (global shim) */
	.kbd {
		display: inline-block;
		padding: 2px 6px;
		border-radius: var(--chip-radius);
		border: 1px solid var(--chip-border);
		background: var(--chip-bg);
		color: var(--chip-fg);
		font-size: var(--chip-font-size);
		margin: 0;
	}

	/* Footer */
	.foot {
		padding: var(--space-2) var(--space-3) var(--space-3);
		border-top: 1px solid var(--popup-border);
	}
	.foot-text {
		color: var(--popup-hint);
		font-size: var(--fs-sm);
		display: inline-block;
	}
}

/* ===========================
   Utilities
   =========================== */
@layer utilities {
	.u-grow {
		width: 100%;
		flex: 1 1 100%;
		min-width: 0;
	}
	.u-stack-sm {
		margin-top: var(--space-2);
	}
	.u-stack-md {
		margin-top: var(--space-3);
	}

	/* Hide in-button chips on very narrow widths */
	@media (max-width: 420px) {
		.btn :where(.btn__kbd) {
			display: none;
		}
	}

	.actions + .row {
		margin-top: var(--space-5);
		padding-top: var(--space-4);
		border-top: 1px solid var(--card-border);
	}
}
