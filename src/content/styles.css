/* ============================================================
   ChatGPT Virtualizer â€” Professional Theme & Consistent Styling
   ============================================================ */

/* ------------------------------
   Base article context
   ------------------------------ */
:root[data-cgpt-virt='on'] article[data-turn-id] {
	position: relative;
}

/* ------------------------------
   Placeholder (collapsed turn)
   ------------------------------ */
:root[data-cgpt-virt='on'] .cgptv-placeholder {
	min-height: 32px;
	display: flex;
	align-items: center;
	justify-content: flex-end;
	gap: var(--cgptv-gap);

	max-width: min(
		var(--cgptv-line-width),
		calc(100% - var(--cgptv-side-gap) * 2)
	);
	margin: 12px auto;
	padding: var(--cgptv-pad-y) var(--cgptv-pad-x) var(--cgptv-pad-y)
		calc(var(--cgptv-pad-x) + 4px);

	border: 1px solid var(--cgptv-border);
	border-left: none;
	border-radius: 8px var(--cgptv-radius) var(--cgptv-radius) 8px;
	background: var(--cgptv-surface-1);

	box-sizing: border-box;
	position: relative;
	transition: background-color var(--cgptv-ease), border-color var(--cgptv-ease);
}

:root[data-cgpt-virt='on'] .cgptv-placeholder:hover {
	background: var(--cgptv-surface-1-hover);
	border-color: var(--cgptv-border-strong);
}

/* Left accent (role hint) */
:root[data-cgpt-virt='on'] .cgptv-placeholder::before {
	content: '';
	position: absolute;
	left: -1px;
	top: -1px;
	bottom: -1px;
	width: 10px;
	border-radius: var(--cgptv-radius) 0px 0px var(--cgptv-radius);
	background: rgba(255, 255, 255, 0.15);
}

/* Role-tinted accent (where supported) */
:root[data-cgpt-virt='on']
	.cgptv-placeholder:has(.cgptv-chip.assistant)::before {
	background: linear-gradient(
		180deg,
		rgba(56, 189, 248, 0.45),
		rgba(56, 189, 248, 0.28)
	);
}
:root[data-cgpt-virt='on'] .cgptv-placeholder:has(.cgptv-chip.user)::before {
	background: linear-gradient(
		180deg,
		rgba(34, 197, 94, 0.45),
		rgba(34, 197, 94, 0.28)
	);
}

/* ------------------------------
   Placeholder label & meta
   ------------------------------ */
:root[data-cgpt-virt='on'] .cgptv-label {
	display: inline-flex;
	align-items: center;
	gap: var(--cgptv-gap);
	color: var(--cgptv-text);
	font: var(--cgptv-font);
	white-space: nowrap;
	overflow: hidden;
	text-overflow: ellipsis;
}

:root[data-cgpt-virt='on'] .cgptv-sep {
	color: var(--cgptv-text-muted);
	opacity: 0.8;
}
:root[data-cgpt-virt='on'] .cgptv-meta {
	color: var(--cgptv-text-muted);
}

/* ------------------------------
   Role chips
   ------------------------------ */
:root[data-cgpt-virt='on'] .cgptv-chip {
	display: inline-flex;
	align-items: center;
	padding: 2px 8px;
	border-radius: var(--cgptv-radius-pill);
	font-size: 11px;
	text-transform: capitalize;
	letter-spacing: 0.2px;
	border: 1px solid transparent;
}

:root[data-cgpt-virt='on'] .cgptv-chip.assistant {
	background: var(--cgptv-chip-assistant-bg);
	border-color: var(--cgptv-chip-assistant-bd);
	color: var(--cgptv-chip-assistant-tx);
}
:root[data-cgpt-virt='on'] .cgptv-chip.user {
	background: var(--cgptv-chip-user-bg);
	border-color: var(--cgptv-chip-user-bd);
	color: var(--cgptv-chip-user-tx);
}
:root[data-cgpt-virt='on'] .cgptv-chip.system {
	background: var(--cgptv-chip-system-bg);
	border-color: var(--cgptv-chip-system-bd);
	color: var(--cgptv-chip-system-tx);
}
:root[data-cgpt-virt='on'] .cgptv-chip.tool {
	background: var(--cgptv-chip-tool-bg);
	border-color: var(--cgptv-chip-tool-bd);
	color: var(--cgptv-chip-tool-tx);
}
:root[data-cgpt-virt='on'] .cgptv-chip.other {
	background: var(--cgptv-chip-other-bg);
	border-color: var(--cgptv-chip-other-bd);
	color: var(--cgptv-chip-other-tx);
}

/* ------------------------------
   Chevron toggle (always outside)
   ------------------------------ */
:root[data-cgpt-virt='on'] .cgptv-btn.cgptv-toggle {
	position: absolute;
	top: 40px;
	transform: translateY(-50%);
	left: calc(50% + (var(--cgptv-line-width) / 2) + var(--cgptv-chevron-gap));

	z-index: 5;

	width: 32px;
	height: 32px;
	display: inline-flex;
	align-items: center;
	justify-content: center;

	border: 1px solid transparent;
	border-radius: var(--cgptv-radius-pill);
	cursor: pointer;

	/* SVG handles visual size; avoid font scaling artifacts */
	line-height: 0;

	background: var(--cgptv-chev-bg);
	color: var(--cgptv-chev-fg);

	transition: background-color var(--cgptv-ease), border-color var(--cgptv-ease),
		color var(--cgptv-ease);
}

/* Ensure chevron is centered inside the button */
:root[data-cgpt-virt='on'] .cgptv-btn.cgptv-toggle {
	display: flex;
	align-items: center;
	justify-content: center;
}

:root[data-cgpt-virt='on'] .cgptv-btn.cgptv-toggle:hover {
	background: var(--cgptv-chev-bg-hover);
}
:root[data-cgpt-virt='on'] .cgptv-btn.cgptv-toggle.is-detached {
	background: var(--cgptv-chev-detached-bg);
	color: var(--cgptv-chev-detached-fg);
}
:root[data-cgpt-virt='on'] .cgptv-btn.cgptv-toggle.is-detached:hover {
	background: var(--cgptv-chev-detached-bg-hover);
}

/* Pinned indicator for chevron button */
:root[data-cgpt-virt='on'] .cgptv-btn.cgptv-toggle.is-pinned::after {
	content: '';
	position: absolute;
	top: -2px;
	right: -2px;
	width: 8px;
	height: 8px;
	border-radius: 50%;
	background: var(--cgptv-pin-dot);
	outline: 1px solid var(--cgptv-border-strong);
}

/* Focus styles for keyboard accessibility */
:root[data-cgpt-virt='on'] .cgptv-btn.cgptv-toggle:focus {
	outline: none;
}
:root[data-cgpt-virt='on'] .cgptv-btn.cgptv-toggle:focus-visible {
	box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.15),
		0 0 0 4px var(--cgptv-border-strong);
}

/* ===== Accessible icon toggle (no color changes) ===== */
:root[data-cgpt-virt='on'] .cgptv-btn.cgptv-toggle .cgptv-icon {
	width: 18px;
	height: 18px;
	display: block; /* avoid inline baseline quirks */
	fill: currentColor;
	/* For inline SVG, ensure the correct reference box for transforms */
	transform-box: fill-box;
	transform-origin: 50% 50%;
	transform: rotate(0deg); /* explicit starting state */
	will-change: transform; /* performance hint */
	transition: transform var(--cgptv-rotate-dur) var(--cgptv-rotate-ease);
}

/* Rotate chevron when expanded (state-based, not hover) */
:root[data-cgpt-virt='on']
	.cgptv-btn.cgptv-toggle[aria-expanded='true']
	.cgptv-icon {
	transform: rotate(90deg);
}

/* Motion respect */
@media (prefers-reduced-motion: reduce) {
	:root[data-cgpt-virt='on'] .cgptv-btn.cgptv-toggle .cgptv-icon {
		transition: none;
	}
}

/* Visually hidden utility for accessible labels */
:root[data-cgpt-virt='on'] .cgptv-visually-hidden {
	position: absolute !important;
	width: 1px;
	height: 1px;
	padding: 0;
	margin: -1px;
	overflow: hidden;
	clip: rect(0 0 0 0);
	white-space: nowrap;
	border: 0;
}

/* ------------------------------
   Wrapper (attached content)
   ------------------------------ */
:root[data-cgpt-virt='on'] .cgptv-wrap {
	/* Visual-neutral container by design */
}

/* ------------------------------
   Bottom safe area for last turn
   ------------------------------ */
:root[data-cgpt-virt='on']
	article[data-turn-id]:last-of-type
	.cgptv-placeholder,
:root[data-cgpt-virt='on'] article[data-turn-id]:last-of-type .cgptv-wrap {
	margin-bottom: var(--cgptv-last-bottom-gap);
}
